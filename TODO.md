[ ] adapt the macro to the two modes